# 软件工程需求规格说明书（SRS）

## 项目名称

行程规划助手（Itinerary Assistant）

## 版本&修订历史

- **版本**：v1.2  
- **日期**：2025-10-28  
- **作者**：GPT-5  
- **变更记录**：更新数据库与为 Firestore；优化云端同步与缓存逻辑。

---

## 1. 引言

**范围**：  

本系统提供一个基于 Web 的 AI 旅行规划系统，支持语音/文字输入、自动行程生成、预算估算与开销记录、地图展示与导航、云端同步与多设备访问。  

系统通过 AI（LLM）为用户自动生成个性化行程和预算，并可语音记录开销，实现高效、直观的旅行管理体验。

**术语**：

- **LLM**：大语言模型（如通义千问/Qwen、GPT 系列、DeepSeek 等）。  
- **STT/TTS**：语音转文本（Speech-to-Text）/文本转语音（Text-to-Speech）。  
- **POI**：兴趣点（景点/餐厅/酒店等）。  
- **Redis 缓存**：用于行程预览及数据加速的临时存储。  
- **Firestore**：Firebase 的文档型（非关系型）数据库，用于云端存储与同步。  
- **ACR**：阿里云容器镜像服务。

---

## 2. 用户画像与使用场景

**用户画像**：

1. **轻度规划用户**：提供目的地、天数、预算与偏好，期望系统一键生成行程。
2. **预算敏感用户**：在规划阶段希望获得精确的预算拆分与费用预测。

**核心场景**：

- 在旅行前，用户语音或文字输入「我想去日本，5 天，预算 1 万元，喜欢美食和动漫，带孩子」，系统自动生成基于地图的行程规划与预算分析。  
- 在旅行中，用户语音记录「今天去了伏见稻荷大社，消费650元」，系统自动识别并记录支出，同时更新预算统计。  
- 用户可登录查看、确认行程并同步到云端，实现跨设备查看。

---

## 3. 功能需求

### 3.1 用户输入功能

#### 3.1.1 语音输入
- 支持语音输入目的地、预算、偏好等信息；后端调用 STT 接口识别文字。  
- 语音识别准确率需高，支持普通话与英语。

#### 3.1.2 文字输入
- 支持表单化输入目的地、日期、预算、同行人数、偏好等。  
- 输入后系统调用 LLM 自动生成个性化旅行计划与预算分析。

---

### 3.2 行程规划功能

#### 3.2.1 AI 行程生成
- 调用 LLM，根据输入生成完整行程，包括交通、住宿、餐饮与景点。  
- 生成结果包含地图标记点（经纬度）与每日活动安排。  
- 行程结果首先缓存到 Redis，用户确认后入库 Firestore。  

#### 3.2.2 行程确认
- 用户在「行程规划」或「预算分析」页面任意确认后，系统将该行程写入 Firestore。  
- Redis 中的缓存行程在确认后同步更新，确保数据一致。

---

### 3.3 预算与开销管理功能

#### 3.3.1 预算生成
- 系统自动计算总预算，并拆分为类别（交通、住宿、餐饮、门票、其他）。  
- 预算结构化存储在行程对象中，未确认行程阶段仅存在 Redis，确认后存储至 Firestore。  

#### 3.3.2 开销记录
- 用户可通过语音或文字输入支出内容，系统自动解析金额、类别并记录。  
- 支出记录与预算对比，实时反馈预算使用情况。  
- 历史支出数据存储在 Firestore 的子集合中。

---

### 3.4 用户与数据管理

#### 3.4.1 用户注册与登录
- 提供统一用户认证。  
- 支持用户名+密码注册与登录。  
- 登录后自动加载用户行程数据（Firestore）。

#### 3.4.2 行程数据管理
- 用户可创建多个行程；系统保存「确认状态」字段区分缓存与云端行程。  
- 用户可查看行程列表、预算信息与地图规划内容。  
- 行程确认后不可编辑，需重新生成。

#### 3.4.3 云端同步
- 已确认行程、预算与支出记录实时存储于 Firestore。  
- 系统利用 Firebase SDK 实现多设备实时同步与监听。  
- Redis 缓存用于减少 Firestore 读取次数，加速访问性能。

---

## 4. 技术要求

### 4.1 技术栈

| 分类         | 技术选型                                 |
| ------------ | ---------------------------------------- |
| 编程语言     | Java                                     |
| 后端框架     | Spring Boot                              |
| 前端框架     | Vue                                    |
| 数据库       | Firestore |               |
| 缓存系统     | Redis                 |
| LLM 行程生成 | 阿里云百炼平台                  |
| 语音识别     | 科大讯飞 API                             |
| 地图导航     | 高德地图 Web API                         |

---

### 4.2 容器化与部署

- 使用 Docker 容器化应用；后端和前端通过 `docker-compose` 管理。  
- 镜像中包含运行 Firestore SDK 与 Redis 客户端的配置。

---

### 4.3 安全与密钥管理

- 禁止在代码中硬编码 API Key。  
- 所有密钥（LLM、地图、Firebase、讯飞）通过配置文件或环境变量加载。  
- 前端用户认证依赖 Firebase Auth SDK；后端仅验证令牌有效性。

---

## 5. 提交与交付要求

- **提交内容：**
  - PDF 文件（包含 GitHub Repo 地址与 README 文档）。  
  - 完整 GitHub 仓库（含提交记录）。  
  - 可直接运行的 Docker 镜像（上传至阿里云镜像仓库，保证3个月可用）。  

- **文档要求：**
  - 提交的 README 中需包含：
    - 系统架构与部署说明。
    - 环境变量配置方式。
    - Docker 运行步骤与测试账号。
    - Firebase 项目配置指引。

---

## 6. 验收标准

- 满足所有功能需求，系统交互流畅。  
- 前后端对接完整、稳定。  
- 用户可通过语音或文字生成行程与预算，并完成确认入库。  
- 云端同步与多设备访问功能验证通过。  
- Docker 镜像可运行，无需额外配置。  
- 文档完整、结构清晰。

---